# 管理员使用指南

## 管理员登录入口

### 方法1: 通过"记录"页面(推荐)

1. 打开小程序
2. 点击底部"记录"标签
3. 在页面顶部会看到"管理员入口"按钮
4. 点击进入管理员登录页面

### 方法2: 通过调试器

1. 打开微信开发者工具
2. 点击"调试器"标签
3. 在 Console 中输入:
   ```javascript
   wx.navigateTo({ url: '/pages/admin/admin' })
   ```

## 管理员账号

**默认账号:**
- 用户名: `admin`
- 密码: `admin123`

**修改管理员密码:**

1. 打开 `cloudfunctions/adminLogin/index.js`
2. 修改第12行的密码:
   ```javascript
   const ADMIN_PASSWORD = 'your_new_password';
   ```
3. 重新部署 `adminLogin` 云函数

## 管理员功能

### 1. 查看所有举报记录

- 进入管理员后台后,会自动加载所有举报记录
- 按时间倒序排列(最新的在最前面)

### 2. 按状态筛选

点击顶部的筛选按钮:
- **全部**: 显示所有举报记录
- **待处理**: 只显示状态为"待处理"的记录
- **已通过**: 只显示状态为"已通过"的记录
- **已驳回**: 只显示状态为"已驳回"的记录

### 3. 查看举报详情

点击"查看"按钮,会弹出模态框显示:
- 诈骗类型
- 涉事电话
- 涉及金额
- 发生时间
- 详细描述

### 4. 查看附件

如果举报包含附件,会在详情页面显示:
- 附件数量(例如: 3个附件)
- 点击可预览图片

### 5. 处理举报

**通过举报:**
1. 找到"待处理"状态的举报
2. 点击"通过"按钮
3. 确认操作
4. 举报状态变为"已通过"

**驳回举报:**
1. 找到"待处理"状态的举报
2. 点击"驳回"按钮
3. 确认操作
4. 举报状态变为"已驳回"

### 6. 退出登录

1. 点击右上角的"退出"按钮
2. 确认退出
3. 返回到登录页面

## 云存储说明

### 为什么云存储是空的?

云存储在以下情况会自动创建文件夹:

1. **上传文件时**: 当用户第一次上传文件时,会自动创建对应的文件夹
2. **手动创建**: 也可以在云开发控制台手动创建

### 云存储目录结构

```
fraud/
├── images/   (图片文件)
├── videos/   (视频文件)
└── files/    (文档文件)
```

### 手动创建云存储文件夹

如果需要手动创建:

1. 点击"云开发"按钮
2. 点击"存储"
3. 点击"创建文件夹"
4. 输入文件夹名称(例如: `fraud/images`)
5. 点击"确定"

重复步骤创建其他文件夹。

### 云存储权限设置

在云开发控制台的"存储"→"权限设置"中:

**推荐设置:**
- 所有用户可读(允许预览)
- 仅创建者可写(防止乱上传)

## 举报处理流程

### 完整流程

1. **用户提交举报**
   - 用户填写举报信息
   - 上传相关证据(图片、视频、文件)
   - 提交后状态为"待处理"

2. **管理员查看举报**
   - 登录管理员后台
   - 查看"待处理"的举报
   - 查看举报详情和附件

3. **管理员处理举报**
   - 点击"通过"或"驳回"
   - 确认操作
   - 状态变为"已通过"或"已驳回"

4. **用户查看结果**
   - 用户在"记录"页面查看举报状态
   - 状态显示为"已通过"或"已驳回"
   - 可以看到处理结果

## 举报状态说明

| 状态 | 说明 | 可操作 |
|------|------|--------|
| pending | 待处理 | 可通过、可驳回 |
| approved | 已通过 | 无操作 |
| rejected | 已驳回 | 无操作 |

## 数据说明

### 数据库字段

**fraud_reports 集合包含以下字段:**

- `_id`: 举报记录ID
- `_openid`: 用户OpenID
- `fraudType`: 诈骗类型
- `phone`: 涉事电话
- `amount`: 涉及金额
- `time`: 发生时间
- `content`: 详细描述
- `attachments`: 附件数组(云存储文件ID)
- `status`: 状态(pending/approved/rejected)
- `submitTime`: 提交时间
- `createTime`: 创建时间
- `handleTime`: 处理时间
- `updateTime`: 更新时间

## 常见问题

### Q1: 看不到"管理员入口"按钮?

A: 确保:
- 已登录小程序
- 在"记录"页面
- 刷新页面

### Q2: 管理员密码忘记了怎么办?

A: 在微信开发者工具中:
1. 打开 `cloudfunctions/adminLogin/index.js`
2. 查看第11-12行的账号密码
3. 如果需要重置,修改后重新部署云函数

### Q3: 如何查看举报的附件?

A:
- 在管理员后台,如果举报有附件,会显示"X个附件"
- 点击附件区域可预览图片
- 视频和文件需要到云存储查看

### Q4: 云存储权限如何设置?

A:
1. 点击"云开发"→"存储"
2. 点击"权限设置"
3. 设置为:
   - 读权限: 所有用户
   - 写权限: 仅创建者

### Q5: 如何导出举报数据?

A:
1. 点击"云开发"→"数据库"
2. 点击"fraud_reports"
3. 点击"导出"
4. 选择导出格式(CSV/JSON)

### Q6: 如何批量处理举报?

A: 目前版本需要逐个处理。后续版本将支持批量操作。

## 安全建议

### 1. 修改默认密码

生产环境务必修改默认密码:

```javascript
const ADMIN_USERNAME = 'your_secure_username';
const ADMIN_PASSWORD = 'your_secure_password';
```

### 2. 限制管理员访问

建议:
- 使用强密码
- 定期更换密码
- 不要在公共设备上登录

### 3. 备份数据

定期:
- 导出数据库
- 备份云存储文件
- 记录重要操作

### 4. 监控异常

关注:
- 异常提交频率
- 短时间内大量相同举报
- 可疑的附件内容

## 性能优化

### 提升加载速度

1. **使用索引**: 在数据库中为常用查询字段创建索引
2. **分页加载**: 当记录数量很大时,使用分页加载
3. **缓存数据**: 使用本地缓存减少请求次数

### 优化建议

1. 定期清理已处理的记录(根据实际需求)
2. 压缩大文件上传
3. 使用CDN加速附件访问

## 技术支持

如遇到问题,请:

1. 查看云函数日志(云开发控制台→云函数→日志)
2. 检查数据库记录(云开发控制台→数据库)
3. 查看Console输出(微信开发者工具→调试器)
4. 参考其他文档:
   - `DEPLOYMENT_GUIDE.md`
   - `CLOUD_FUNCTION_DEPLOY.md`
   - `TROUBLESHOOTING.md`

## 更新日志

**v1.1 (2026-02-26)**
- 添加管理员入口到"记录"页面
- 支持查看附件
- 优化界面样式
- 修复云函数错误

**v1.0 (2026-02-26)**
- 初始版本
- 支持用户登录
- 支持举报提交
- 支持管理员处理
