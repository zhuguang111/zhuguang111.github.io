# 微信小程序部署指南

## 第一步: 准备工作

### 1.1 下载项目

从 GitHub 下载项目:
1. 访问: https://github.com/zhuguang111/zhuguang111.github.io
2. 点击 "Code" 按钮
3. 选择 "Download ZIP"
4. 解压 ZIP 文件
5. 进入解压后的文件夹

### 1.2 检查项目结构

确认项目结构如下:
```
zhuguang111.github.io/
└── wechat-anti-fraud-miniapp/
    ├── app.js
    ├── app.json
    ├── pages/
    ├── cloudfunctions/
    └── ...
```

## 第二步: 在微信开发者工具中导入项目

### 2.1 打开微信开发者工具

1. 打开微信开发者工具
2. 点击 "+" 或"导入项目"

### 2.2 填写项目信息

- **项目名称**: 防诈骗线索举报
- **目录**: 选择 `wechat-anti-fraud-miniapp` 文件夹
- **AppID**: wx6b4f24f7e154d8b5

### 2.3 选择云开发模式

**重要**: 必须选择"云开发"模式
- ✅ 勾选"启用云开发"
- ❌ 不要选择"不使用云服务"

## 第三步: 配置云开发环境

### 3.1 开通云开发

1. 点击工具栏上的"云开发"按钮
2. 首次使用会提示"开通云开发"
3. 点击"开通"
4. 同意《微信小程序云开发服务协议》
5. 填写环境名称,例如: `fraud-report`
6. 环境ID会自动生成,记下这个ID

### 3.2 修改环境ID

如果自动生成的环境ID不是 `zhuguang-1gctmq3g17561f0c`,需要手动修改:

1. 打开 `app.js` 文件
2. 找到 `wx.cloud.init()` 部分
3. 修改 `env` 参数为您的实际环境ID:

```javascript
wx.cloud.init({
  env: '您的实际环境ID',  // 修改这里
  traceUser: true,
});
```

## 第四步: 创建数据库集合

### 4.1 打开云开发控制台

1. 在微信开发者工具中点击"云开发"按钮
2. 进入云开发控制台

### 4.2 创建 users 集合

1. 点击左侧"数据库"
2. 点击"+"号创建集合
3. 集合名称: `users`
4. 权限设置: 选择"仅创建者可读写"
5. 点击"确定"

### 4.3 创建 fraud_reports 集合

1. 再次点击"+"号创建集合
2. 集合名称: `fraud_reports`
3. 权限设置: 选择"仅创建者可读写"
4. 点击"确定"

### 4.4 创建云存储目录

1. 点击左侧"存储"
2. 点击"创建文件夹"
3. 文件夹名称: `fraud`
4. 点击"确定"

## 第五步: 部署云函数

### 5.1 部署 login 云函数

1. 在微信开发者工具左侧文件树中找到 `cloudfunctions/login`
2. 右键点击 `login` 文件夹
3. 选择"上传并部署:云端安装依赖"
4. 等待部署完成(可能需要1-2分钟)

### 5.2 部署 submitFraud 云函数

1. 找到 `cloudfunctions/submitFraud`
2. 右键点击 `submitFraud` 文件夹
3. 选择"上传并部署:云端安装依赖"
4. 等待部署完成

### 5.3 部署 getFraudRecords 云函数

1. 找到 `cloudfunctions/getFraudRecords`
2. 右键点击 `getFraudRecords` 文件夹
3. 选择"上传并部署:云端安装依赖"
4. 等待部署完成

### 5.4 验证云函数部署

在云开发控制台的"云函数"页面,您应该能看到三个云函数:
- login
- submitFraud
- getFraudRecords

## 第六步: 测试项目

### 6.1 编译运行

1. 在微信开发者工具中点击"编译"按钮
2. 在右侧预览区会看到小程序界面

### 6.2 测试登录

1. 点击"授权登录"按钮
2. 确认授权信息
3. 登录成功后会显示用户信息

### 6.3 测试提交举报

1. 点击底部"举报"标签
2. 填写举报信息:
   - 选择诈骗类型
   - 输入电话号码
   - 填写详细描述
   - (可选)上传图片
3. 点击"提交举报"
4. 等待提交成功提示

### 6.4 查看举报记录

1. 点击底部"记录"标签
2. 查看提交的举报记录

## 第七步: 真机测试

### 7.1 预览小程序

1. 点击工具栏上的"预览"按钮
2. 扫描二维码在手机上打开
3. 在手机上测试完整功能

### 7.2 调试工具

如果遇到问题:
1. 点击工具栏上的"调试器"
2. 查看Console输出的错误信息
3. 检查Network请求是否正常

## 常见问题排查

### 问题1: 登录失败

**可能原因**:
- 云函数未部署成功
- 环境ID配置错误
- 数据库集合未创建

**解决方法**:
1. 检查云函数是否部署成功
2. 确认 `app.js` 中的环境ID正确
3. 确认数据库 `users` 集合已创建

### 问题2: 提交失败

**可能原因**:
- 云存储未配置
- `submitFraud` 云函数未部署
- 数据库 `fraud_reports` 集合未创建

**解决方法**:
1. 确认云存储 `fraud` 文件夹已创建
2. 检查 `submitFraud` 云函数是否部署成功
3. 确认数据库 `fraud_reports` 集合已创建

### 问题3: 无法上传图片

**可能原因**:
- 云存储未开通
- 权限配置问题

**解决方法**:
1. 在云开发控制台确认"存储"已开通
2. 检查存储权限设置

### 问题4: 云函数部署失败

**可能原因**:
- 网络问题
- 依赖安装失败

**解决方法**:
1. 检查网络连接
2. 尝试重新上传并部署
3. 查看云函数日志获取详细错误信息

## 重要提示

1. **必须使用云开发模式**: 如果选择"不使用云服务",所有云功能都无法使用
2. **环境ID必须匹配**: `app.js` 中的环境ID必须与云开发控制台中的环境ID一致
3. **云函数必须部署**: 所有云函数都必须上传并部署才能使用
4. **数据库集合必须创建**: `users` 和 `fraud_reports` 集合必须手动创建
5. **云存储必须配置**: 必须创建 `fraud` 文件夹用于存储图片

## 开发建议

1. 使用真机调试进行测试
2. 定期查看云函数日志
3. 监控数据库和存储使用情况
4. 注意小程序包体积限制

## 联系支持

如果遇到无法解决的问题:
1. 查看微信官方文档: https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html
2. 查看云函数日志获取详细错误信息
3. 在开发者工具中检查Console输出
